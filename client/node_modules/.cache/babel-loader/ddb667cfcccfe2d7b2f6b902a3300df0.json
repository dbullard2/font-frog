{"ast":null,"code":"// The `kern` table contains kerning pairs.\n// Note that some fonts use the GPOS OpenType layout table to specify kerning.\n// https://www.microsoft.com/typography/OTSPEC/kern.htm\nimport check from '../check';\nimport parse from '../parse';\n\nfunction parseWindowsKernTable(p) {\n  var pairs = {}; // Skip nTables.\n\n  p.skip('uShort');\n  var subtableVersion = p.parseUShort();\n  check.argument(subtableVersion === 0, 'Unsupported kern sub-table version.'); // Skip subtableLength, subtableCoverage\n\n  p.skip('uShort', 2);\n  var nPairs = p.parseUShort(); // Skip searchRange, entrySelector, rangeShift.\n\n  p.skip('uShort', 3);\n\n  for (var i = 0; i < nPairs; i += 1) {\n    var leftIndex = p.parseUShort();\n    var rightIndex = p.parseUShort();\n    var value = p.parseShort();\n    pairs[leftIndex + ',' + rightIndex] = value;\n  }\n\n  return pairs;\n}\n\nfunction parseMacKernTable(p) {\n  var pairs = {}; // The Mac kern table stores the version as a fixed (32 bits) but we only loaded the first 16 bits.\n  // Skip the rest.\n\n  p.skip('uShort');\n  var nTables = p.parseULong(); //check.argument(nTables === 1, 'Only 1 subtable is supported (got ' + nTables + ').');\n\n  if (nTables > 1) {\n    console.warn('Only the first kern subtable is supported.');\n  }\n\n  p.skip('uLong');\n  var coverage = p.parseUShort();\n  var subtableVersion = coverage & 0xFF;\n  p.skip('uShort');\n\n  if (subtableVersion === 0) {\n    var nPairs = p.parseUShort(); // Skip searchRange, entrySelector, rangeShift.\n\n    p.skip('uShort', 3);\n\n    for (var i = 0; i < nPairs; i += 1) {\n      var leftIndex = p.parseUShort();\n      var rightIndex = p.parseUShort();\n      var value = p.parseShort();\n      pairs[leftIndex + ',' + rightIndex] = value;\n    }\n  }\n\n  return pairs;\n} // Parse the `kern` table which contains kerning pairs.\n\n\nfunction parseKernTable(data, start) {\n  var p = new parse.Parser(data, start);\n  var tableVersion = p.parseUShort();\n\n  if (tableVersion === 0) {\n    return parseWindowsKernTable(p);\n  } else if (tableVersion === 1) {\n    return parseMacKernTable(p);\n  } else {\n    throw new Error('Unsupported kern table version (' + tableVersion + ').');\n  }\n}\n\nexport default {\n  parse: parseKernTable\n};","map":null,"metadata":{},"sourceType":"module"}