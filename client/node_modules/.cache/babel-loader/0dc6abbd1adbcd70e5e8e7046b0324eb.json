{"ast":null,"code":"// The `GPOS` table contains kerning pairs, among other things.\n// https://www.microsoft.com/typography/OTSPEC/gpos.htm\nimport check from '../check';\nimport { decode } from '../types';\nimport parse from '../parse';\nimport table from '../table'; // Parse the metadata `meta` table.\n// https://developer.apple.com/fonts/TrueType-Reference-Manual/RM06/Chap6meta.html\n\nfunction parseMetaTable(data, start) {\n  var p = new parse.Parser(data, start);\n  var tableVersion = p.parseULong();\n  check.argument(tableVersion === 1, 'Unsupported META table version.');\n  p.parseULong(); // flags - currently unused and set to 0\n\n  p.parseULong(); // tableOffset\n\n  var numDataMaps = p.parseULong();\n  var tags = {};\n\n  for (var i = 0; i < numDataMaps; i++) {\n    var tag = p.parseTag();\n    var dataOffset = p.parseULong();\n    var dataLength = p.parseULong();\n    var text = decode.UTF8(data, start + dataOffset, dataLength);\n    tags[tag] = text;\n  }\n\n  return tags;\n}\n\nfunction makeMetaTable(tags) {\n  var numTags = Object.keys(tags).length;\n  var stringPool = '';\n  var stringPoolOffset = 16 + numTags * 12;\n  var result = new table.Table('meta', [{\n    name: 'version',\n    type: 'ULONG',\n    value: 1\n  }, {\n    name: 'flags',\n    type: 'ULONG',\n    value: 0\n  }, {\n    name: 'offset',\n    type: 'ULONG',\n    value: stringPoolOffset\n  }, {\n    name: 'numTags',\n    type: 'ULONG',\n    value: numTags\n  }]);\n\n  for (var tag in tags) {\n    var pos = stringPool.length;\n    stringPool += tags[tag];\n    result.fields.push({\n      name: 'tag ' + tag,\n      type: 'TAG',\n      value: tag\n    });\n    result.fields.push({\n      name: 'offset ' + tag,\n      type: 'ULONG',\n      value: stringPoolOffset + pos\n    });\n    result.fields.push({\n      name: 'length ' + tag,\n      type: 'ULONG',\n      value: tags[tag].length\n    });\n  }\n\n  result.fields.push({\n    name: 'stringPool',\n    type: 'CHARARRAY',\n    value: stringPool\n  });\n  return result;\n}\n\nexport default {\n  parse: parseMetaTable,\n  make: makeMetaTable\n};","map":null,"metadata":{},"sourceType":"module"}