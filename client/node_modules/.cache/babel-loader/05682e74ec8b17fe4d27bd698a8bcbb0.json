{"ast":null,"code":"// The `GPOS` table contains kerning pairs, among other things.\n// https://docs.microsoft.com/en-us/typography/opentype/spec/gpos\nimport check from '../check';\nimport { Parser } from '../parse';\nimport table from '../table';\nvar subtableParsers = new Array(10); // subtableParsers[0] is unused\n// https://docs.microsoft.com/en-us/typography/opentype/spec/gpos#lookup-type-1-single-adjustment-positioning-subtable\n// this = Parser instance\n\nsubtableParsers[1] = function parseLookup1() {\n  var start = this.offset + this.relativeOffset;\n  var posformat = this.parseUShort();\n\n  if (posformat === 1) {\n    return {\n      posFormat: 1,\n      coverage: this.parsePointer(Parser.coverage),\n      value: this.parseValueRecord()\n    };\n  } else if (posformat === 2) {\n    return {\n      posFormat: 2,\n      coverage: this.parsePointer(Parser.coverage),\n      values: this.parseValueRecordList()\n    };\n  }\n\n  check.assert(false, '0x' + start.toString(16) + ': GPOS lookup type 1 format must be 1 or 2.');\n}; // https://docs.microsoft.com/en-us/typography/opentype/spec/gpos#lookup-type-2-pair-adjustment-positioning-subtable\n\n\nsubtableParsers[2] = function parseLookup2() {\n  var start = this.offset + this.relativeOffset;\n  var posFormat = this.parseUShort();\n  check.assert(posFormat === 1 || posFormat === 2, '0x' + start.toString(16) + ': GPOS lookup type 2 format must be 1 or 2.');\n  var coverage = this.parsePointer(Parser.coverage);\n  var valueFormat1 = this.parseUShort();\n  var valueFormat2 = this.parseUShort();\n\n  if (posFormat === 1) {\n    // Adjustments for Glyph Pairs\n    return {\n      posFormat: posFormat,\n      coverage: coverage,\n      valueFormat1: valueFormat1,\n      valueFormat2: valueFormat2,\n      pairSets: this.parseList(Parser.pointer(Parser.list(function () {\n        return {\n          // pairValueRecord\n          secondGlyph: this.parseUShort(),\n          value1: this.parseValueRecord(valueFormat1),\n          value2: this.parseValueRecord(valueFormat2)\n        };\n      })))\n    };\n  } else if (posFormat === 2) {\n    var classDef1 = this.parsePointer(Parser.classDef);\n    var classDef2 = this.parsePointer(Parser.classDef);\n    var class1Count = this.parseUShort();\n    var class2Count = this.parseUShort();\n    return {\n      // Class Pair Adjustment\n      posFormat: posFormat,\n      coverage: coverage,\n      valueFormat1: valueFormat1,\n      valueFormat2: valueFormat2,\n      classDef1: classDef1,\n      classDef2: classDef2,\n      class1Count: class1Count,\n      class2Count: class2Count,\n      classRecords: this.parseList(class1Count, Parser.list(class2Count, function () {\n        return {\n          value1: this.parseValueRecord(valueFormat1),\n          value2: this.parseValueRecord(valueFormat2)\n        };\n      }))\n    };\n  }\n};\n\nsubtableParsers[3] = function parseLookup3() {\n  return {\n    error: 'GPOS Lookup 3 not supported'\n  };\n};\n\nsubtableParsers[4] = function parseLookup4() {\n  return {\n    error: 'GPOS Lookup 4 not supported'\n  };\n};\n\nsubtableParsers[5] = function parseLookup5() {\n  return {\n    error: 'GPOS Lookup 5 not supported'\n  };\n};\n\nsubtableParsers[6] = function parseLookup6() {\n  return {\n    error: 'GPOS Lookup 6 not supported'\n  };\n};\n\nsubtableParsers[7] = function parseLookup7() {\n  return {\n    error: 'GPOS Lookup 7 not supported'\n  };\n};\n\nsubtableParsers[8] = function parseLookup8() {\n  return {\n    error: 'GPOS Lookup 8 not supported'\n  };\n};\n\nsubtableParsers[9] = function parseLookup9() {\n  return {\n    error: 'GPOS Lookup 9 not supported'\n  };\n}; // https://docs.microsoft.com/en-us/typography/opentype/spec/gpos\n\n\nfunction parseGposTable(data, start) {\n  start = start || 0;\n  var p = new Parser(data, start);\n  var tableVersion = p.parseVersion(1);\n  check.argument(tableVersion === 1 || tableVersion === 1.1, 'Unsupported GPOS table version ' + tableVersion);\n\n  if (tableVersion === 1) {\n    return {\n      version: tableVersion,\n      scripts: p.parseScriptList(),\n      features: p.parseFeatureList(),\n      lookups: p.parseLookupList(subtableParsers)\n    };\n  } else {\n    return {\n      version: tableVersion,\n      scripts: p.parseScriptList(),\n      features: p.parseFeatureList(),\n      lookups: p.parseLookupList(subtableParsers),\n      variations: p.parseFeatureVariationsList()\n    };\n  }\n} // GPOS Writing //////////////////////////////////////////////\n// NOT SUPPORTED\n\n\nvar subtableMakers = new Array(10);\n\nfunction makeGposTable(gpos) {\n  return new table.Table('GPOS', [{\n    name: 'version',\n    type: 'ULONG',\n    value: 0x10000\n  }, {\n    name: 'scripts',\n    type: 'TABLE',\n    value: new table.ScriptList(gpos.scripts)\n  }, {\n    name: 'features',\n    type: 'TABLE',\n    value: new table.FeatureList(gpos.features)\n  }, {\n    name: 'lookups',\n    type: 'TABLE',\n    value: new table.LookupList(gpos.lookups, subtableMakers)\n  }]);\n}\n\nexport default {\n  parse: parseGposTable,\n  make: makeGposTable\n};","map":null,"metadata":{},"sourceType":"module"}