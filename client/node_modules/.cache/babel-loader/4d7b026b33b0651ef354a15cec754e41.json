{"ast":null,"code":"// The Position object provides utility methods to manipulate\n// the GPOS position table.\nimport Layout from './layout';\n/**\n * @exports opentype.Position\n * @class\n * @extends opentype.Layout\n * @param {opentype.Font}\n * @constructor\n */\n\nfunction Position(font) {\n  Layout.call(this, font, 'gpos');\n}\n\nPosition.prototype = Layout.prototype;\n/**\n * Init some data for faster and easier access later.\n */\n\nPosition.prototype.init = function () {\n  var script = this.getDefaultScriptName();\n  this.defaultKerningTables = this.getKerningTables(script);\n};\n/**\n * Find a glyph pair in a list of lookup tables of type 2 and retrieve the xAdvance kerning value.\n *\n * @param {integer} leftIndex - left glyph index\n * @param {integer} rightIndex - right glyph index\n * @returns {integer}\n */\n\n\nPosition.prototype.getKerningValue = function (kerningLookups, leftIndex, rightIndex) {\n  for (var i = 0; i < kerningLookups.length; i++) {\n    var subtables = kerningLookups[i].subtables;\n\n    for (var j = 0; j < subtables.length; j++) {\n      var subtable = subtables[j];\n      var covIndex = this.getCoverageIndex(subtable.coverage, leftIndex);\n      if (covIndex < 0) continue;\n\n      switch (subtable.posFormat) {\n        case 1:\n          // Search Pair Adjustment Positioning Format 1\n          var pairSet = subtable.pairSets[covIndex];\n\n          for (var k = 0; k < pairSet.length; k++) {\n            var _pair = pairSet[k];\n\n            if (_pair.secondGlyph === rightIndex) {\n              return _pair.value1 && _pair.value1.xAdvance || 0;\n            }\n          }\n\n          break;\n        // left glyph found, not right glyph - try next subtable\n\n        case 2:\n          // Search Pair Adjustment Positioning Format 2\n          var class1 = this.getGlyphClass(subtable.classDef1, leftIndex);\n          var class2 = this.getGlyphClass(subtable.classDef2, rightIndex);\n          var pair = subtable.classRecords[class1][class2];\n          return pair.value1 && pair.value1.xAdvance || 0;\n      }\n    }\n  }\n\n  return 0;\n};\n/**\n * List all kerning lookup tables.\n *\n * @param {string} [script='DFLT'] - use font.position.getDefaultScriptName() for a better default value\n * @param {string} [language='dflt']\n * @return {object[]} The list of kerning lookup tables (may be empty), or undefined if there is no GPOS table (and we should use the kern table)\n */\n\n\nPosition.prototype.getKerningTables = function (script, language) {\n  if (this.font.tables.gpos) {\n    return this.getLookupTables(script, language, 'kern', 2);\n  }\n};\n\nexport default Position;","map":null,"metadata":{},"sourceType":"module"}